<!DOCTYPE HTML>
<html>
	<head>
		<title>Media Viewer</title>
		<link href="style.css" rel="stylesheet" type="text/css">
	</head>
	<body>
		<div id="header">
			<h1>Media Viewer</h1>
			<br>
			<a href="/">Home</a>
			<a href="/search">Search</a>
			<a href="/view">View</a>
			<a href="/modifytags">Modify Tags</a>
			<a href="/settings">Settings</a>
			<a href="/help">Help</a>
		</div>


		<div id="content">
			<input type="search" id="searchBar">
			<button onclick="search()">Search</button>
			<br>

			<!-- buttons for testing -->
			<button onclick="document.getElementById('searchDisplay').appendChild(generateMediaBox('walter.png', 'image', 300, 300))">Add Walter</button> 
			<button onclick="document.getElementById('searchDisplay').appendChild(generateMediaBox('walter2.png', 'image', 300, 300))">Add Walter2</button> 

			<div id="searchDisplay">
				<p>Display</p>
			</div>
		</div>

		<!-- JS -->
		<template id="mediaBoxTemplate">
			<div class="mediaBox">
				<p class="mediaText"></p>
				<img class="mediaImage"></div>
			</div>
		</template>

		<script src="scripts.js"></script>

		<script>
			document.getElementById('searchBar').onkeydown = function(event) {
			    if (event.keyCode == 13) {
			        search();
			    }
			}
			// redirects user to the right page to search
			function search() {
				var query = document.getElementById("searchBar").value;
				window.location.href = "/search?q=" + query;
			}

			window.onload = onLoadSearch();
			// search function called whenever the page loads
			function onLoadSearch() { // !! todo: fix this function so it works with &&, ||, and ! operators 
				var urlSearchParams = new URLSearchParams(window.location.search);
				var query = urlSearchParams.get("q");
				if(query != null) {
					var req = new XMLHttpRequest();
					req.open("GET", "/searchresults?q=" + query);
					req.send();
					req.onreadystatechange=(e)=>{
						if(req.readyState == 4) {
							console.log(req.responseText);
							var jsonResult = JSON.parse(req.responseText);
							for(var i = 0; i < jsonResult.mediaItems.length; i++) {
								var mediaItem = jsonResult.mediaItems[i];
								document.getElementById('searchDisplay').appendChild(generateMediaBox(mediaItem.path, mediaItem.fileType, 300, 300));
							}
						}
					}
				}
			}
		</script>

	</body>
</html>